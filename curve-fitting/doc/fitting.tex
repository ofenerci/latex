\chapter*{Fitting data by the method of least squares}
%
[Harold Cohen. Numerical approximation methods, p. 25.]

Given experimental data points $\tuple{x_k, y_k}$ and a hypothesized model equation to fit data $f\vat{x_k}$ with unknown coefficients $\alpha_k$, the method of least squares consists on minimizing the square of the rms error $e = \ssum{k}{\epsilon_k}^2 = \ssum{k}{\left(f_k - y_k\right)^2}$ wrt the coefficients $\alpha_k$.


For instance, consider that a theory predicts that the data in \cref{tab:data} decreases with increasing $x$ as a quadratic in $1/x$.
%
% ------------------------------------------------------------- PreTable
\docpretable{bt}{0.18\textwidth}{cc}%
% position: bthH. size: 0.9\textwidth. cols: llcp{6mm}
% use: \docfloatwidth whenever possible!
% NOTE: does not include \toprule
%
\toprule
%
$x_k$ & $y_k$ \\
%
\midrule
%
1.3 & 5.42 \\
2.2 & 4.28 \\
3.7 & 3.81 \\
4.9 & 3.62 \\
%
\bottomrule
%
% ------------------------------------------------------------ PostTable
\end{tabularx}
\docposttable{Fitting data}{Data with inverse power of $x$ decrease}{tab:data}
% include: \end{tabularx}%
% ------------------------------------------------------------- EndTable

Define the model to fit the data:
\beq
    f\vat x = \alpha_1 + \alpha_2 \dfrac{1}{x} + \alpha_3 \dfrac{1}{x^2}\,.
\eeq
%
Find the square of the rms error of the model and the data:
%
\beq
    e = \ssum{k}{\left(\alpha_1 + \alpha_2\dfrac{1}{x} + \alpha_3\dfrac{1}{x^2} - y_k\right)^2}\,.    
\eeq
%
Minimize $e$ with respect to the coefficients $\alpha_k$:
%
\begin{align*}
%
\ipd{\alpha_1} e &= 2\ssum{k}{\left(\alpha_1 + \alpha_2\dfrac{1}{x_k} + \alpha_3\dfrac{1}{x_k^2} - y_k\right)} = 0\,,\\
%
\ipd{\alpha_2} e &= 2\dfrac{1}{x_k}\ssum{k}{\left(\alpha_1 + \alpha_2\dfrac{1}{x_k} 
                    + \alpha_3\dfrac{1}{x_k^2} - y_k\right)} = 0\,,\\
%
\ipd{\alpha_3} e &= 2\dfrac{1}{x^2_k}\ssum{k}{\left(\alpha_1 + \alpha_2\dfrac{1}{x_k} 
                    + \alpha_3\dfrac{1}{x_k^2} - y_k\right)} = 0\,.
%
\end{align*}
%
Distribute the sums in every term, perform algebra and replace the values of \cref{tab:data} to have
%
\begin{align*}
    4.000\alpha_1 + 1.698\alpha_2 + 0.913\alpha_3 &= 17.130\,,\\
    1.698\alpha_1 + 0.913\alpha_2 + 0.577\alpha_3 &= 7.883\,,\\
    0.913\alpha_1 + 0.577\alpha_2 + 0.400\alpha_3 &= 4.52\,.
\end{align*}
%
Solve the system to find $\elset{\alpha_1 = 3.261, \alpha_2 = 1.480, \alpha_3 = 1.722}$. The model equation thus becomes
%
\beq
    f\vat x = 3.261 + 1.480\dfrac{1}{x} + 1.722\dfrac{1}{x^2}
\eeq
%
and its error in fitting data
%
\beq
    e = \sum_{k = 1}^4\left( 3.261 + 1.480\dfrac{1}{x} + 1.722\dfrac{1}{x^2} - y_k\right)^2 
      = 0.001\,. \mqed
\eeq
